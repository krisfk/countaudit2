
jQuery(window).on("load",function(){lfb_initPayForm()});function lfb_initPayForm(){jQuery("html,body").css({overflow:"hidden"});var a=jQuery('<div id="lfb_bootstraped" class="lfb_bootstraped lfb_payForm"></div>');a.append('<div id="estimation_popup" data-form="'+lfb_dataPay.formID+'" class="wpe_bootstraped  wpe_fullscreen"><div id="mainPanel" style="display: block !important;"><div id="lfb_summary"></div></div></div>');jQuery("body").html(a);if(lfb_dataPay.key!=""){jQuery.ajax({url:lfb_dataPay.ajaxurl,type:"post",data:{action:"lfb_getFormToPay",key:lfb_dataPay.key},success:function(b){if(b.length<5){jQuery("#lfb_bootstraped.lfb_payForm").remove();document.location.href=lfb_dataPay.homeUrl}else{a.find("#lfb_summary").html(b);a.find("#lfb_summary table").parent().css({paddingLeft:0,paddingRight:0});a.find("#lfb_summary").find("[bgcolor]").each(function(){jQuery(this).css({backgroundColor:jQuery(this).attr("bgcolor")})});a.find("#lfb_summary").find("[width]").each(function(){jQuery(this).css({width:jQuery(this).attr("width")})});if(a.find("#lfb_summary table").attr("border")!="0"){a.find("#lfb_summary table").find("th,td").css({border:"1px solid "+a.find("#lfb_summary table").attr("bordercolor")})}lfb_initPayment()}}})}}function lfb_initPayment(){if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm').length>0){Stripe.setPublishableKey(lfb_dataPay.stripePubKey)}jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm').submit(function(b){var a=false;jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="number"]').closest(".form-group").removeClass("has-error");jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="exp_month"]').closest(".form-group").removeClass("has-error");jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="exp_year"]').closest(".form-group").removeClass("has-error");jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="cvc"]').closest(".form-group").removeClass("has-error");if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="number"]').val().length<5){a=true;jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="number"]').closest(".form-group").addClass("has-error")}if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="exp_month"]').val().length<2){a=true;jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="exp_month"]').closest(".form-group").addClass("has-error")}if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="exp_year"]').val().length<2){a=true;jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="exp_year"]').closest(".form-group").addClass("has-error")}if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="cvc"]').val().length<2){a=true;jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm [data-stripe="cvc"]').closest(".form-group").addClass("has-error")}if(!a){jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm #wpe_btnOrderStripe').prop("disabled",true);Stripe.card.createToken(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #lfb_stripeForm'),function(c,d){lfb_stripeResponsePay(c,d,lfb_dataPay.formID)})}return false});lfb_initPaypalForm()}function lfb_stripeResponsePay(a,c,e){var b=jQuery('#estimation_popup.wpe_bootstraped[data-form="'+e+'"] #lfb_stripeForm');if(c.error){b.find(".payment-errors").text(c.error.message);b.find(".btn").prop("disabled",false)}else{var d=c.id;if(b.find('[name="stripeToken"]').length==0){b.append(jQuery('<input type="hidden" name="stripeToken">').val(d));Stripe.card.createToken(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+e+'"] #lfb_stripeForm'),function(g,f){lfb_stripeResponsePay(g,f,e)})}else{if(b.find('[name="stripeTokenB"]').length==0){b.append(jQuery('<input type="hidden" name="stripeTokenB">').val(d));lfb_validOrder(lfb_dataPay.formID)}}}}function lfb_initPaypalForm(){if(jQuery("#wtmt_paypalForm").length>0){jQuery("#btnOrderPaypal").click(function(){jQuery('#wtmt_paypalForm [name="submit"]').trigger("click")});var b=lfb_dataPay.total;b=parseFloat(b)*(parseFloat(lfb_dataPay.percentToPay)/100);b=parseFloat(b).toFixed(2);if(lfb_dataPay.priceSingle>0){var a=parseFloat(lfb_dataPay.total)*(parseFloat(lfb_dataPay.percentToPay)/100);a=parseFloat(a).toFixed(2);if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=a1]').length==0){jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm').append('<input type="hidden" name="a1" value="0"/>');jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm').append('<input type="hidden" name="p1" value="1"/>');jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm').append('<input type="hidden" name="t1" value="M"/>')}jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=a1]').val(lfb_dataPay.totalSub);jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=p1]').val(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=p3]').val());if(b<=0){jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=cmd]').val("_xclick");jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=a3]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=t3]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=p3]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=bn]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=no_note]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=src]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=a1]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=t1]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=p1]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm').append('<input type="hidden" name="amount" value="'+lfb_dataPay.total+'"/>')}}else{jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=a1]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=t1]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=p1]').remove();jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=amount]').val(lfb_dataPay.total)}jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=return]').val(lfb_dataPay.finalUrl);jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=a3]').val(lfb_dataPay.total);jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=custom]').val(lfb_dataPay.ref);jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] #wtmt_paypalForm [name=item_number]').val(lfb_dataPay.ref);jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.ref+'"] #wtmt_paypalForm [name=item_name]').val(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.ref+'"] #wtmt_paypalForm [name=item_name]').val()+" - "+lfb_dataPay.ref);jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.ref+'"] #wtmt_paypalForm [type="submit"]').trigger("click")}}function lfb_validOrder(c){var b="";if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] [name="stripeToken"]').length>0){b=jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] [name="stripeToken"]').val()}var a="";if(jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] [name="stripeTokenB"]').length>0){a=jQuery('#estimation_popup.wpe_bootstraped[data-form="'+lfb_dataPay.formID+'"] [name="stripeTokenB"]').val()}jQuery.ajax({url:lfb_dataPay.ajaxurl,type:"post",data:{action:"lfb_validPayForm",formID:lfb_dataPay.formID,orderKey:lfb_dataPay.key,stripeToken:b,stripeTokenB:a},success:function(d){jQuery("#estimation_popup #mainPanel").prepend('<h2 style="display:none;" id="lfb_payFormFinalTxt">'+lfb_dataPay.finalText+"</h2>");jQuery("#estimation_popup #mainPanel #lfb_summary").fadeOut();setTimeout(function(){jQuery("#estimation_popup #mainPanel #lfb_payFormFinalTxt").fadeIn();setTimeout(function(){if(lfb_dataPay.finalUrl!=""&&lfb_dataPay.finalUrl!="#"&&lfb_dataPay.finalUrl!=" "){document.location.href=lfb_dataPay.finalUrl}},lfb_dataPay.redirectionDelay*1000)},300)}})};